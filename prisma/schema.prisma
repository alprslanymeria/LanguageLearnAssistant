
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model User {
  id                    String                @id
  name                  String
  email                 String
  emailVerified         Boolean               @default(false)
  image                 String?
  nativeLanguageId      Int?                  @default(2)
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @default(now()) @updatedAt

  //REFERANS VERDİKLERİ (CHILD'LARI)
  sessions              Session[]
  accounts              Account[]
  liveSession           LiveSession?
  flashcards            Flashcard[]
  listenings            Listening[]
  writings              Writing[]
  readings              Reading[]

  //REFERANS ALDIKLARI (PARENT'LARI)
  language              Language?             @relation(fields: [nativeLanguageId], references: [id])

  @@unique([email])
  @@map("user")
}

model Session {
  id                    String                @id
  expiresAt             DateTime
  token                 String
  ipAddress             String?
  userAgent             String?
  userId                String
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt

  //REFERANS ALDIKLARI (PARENT'LARI)
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String                @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?               @db.NVarChar(Max)
  refreshToken          String?               @db.NVarChar(Max)
  idToken               String?               @db.NVarChar(Max)
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt

  //REFERANS ALDIKLARI (PARENT'LARI)
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("account")
}

model Verification {
  id                    String                @id
  identifier            String
  value                 String
  expiresAt             DateTime
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @default(now()) @updatedAt

  @@map("verification")
}

model Language {
  id                    Int                   @id @default(autoincrement())
  name                  String
  imageUrl              String?

  //REFERANS VERDİKLERİ (CHILD'LARI)
  practices             Practice[]
  flashcards            Flashcard[]
  listenings            Listening[]
  writings              Writing[]
  readings              Reading[]
  user                  User[]

}

model Practice {
  id                    Int                   @id @default(autoincrement())
  languageId            Int
  name                  String

  //REFERANS VERDİKLERİ (CHILD'LARI)
  flashcards            Flashcard[]
  listenings            Listening[]
  writings              Writing[]
  readings              Reading[]

  //REFERANS ALDIKLARI (PARENT'LARI)
  language              Language              @relation(fields: [languageId], references: [id])

  //UNIQUE CONSTRAINT
  @@unique([languageId, name], name: "languageId_name")
}

model LiveSession {
  liveSessionId         String                @id
  userId                String                @unique

  //REFERANS ALDIKLARI (PARENT'LARI)
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Flashcard {
  id                    Int                   @id @default(autoincrement())
  userId                String
  languageId            Int
  practiceId            Int

  //REFERANS ALDIKLARI (PARENT'LARI)
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  language              Language              @relation(fields: [languageId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  practice              Practice              @relation(fields: [practiceId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  flashcardCategories   FlashcardCategory[]
  flashcardOldSessions  FlashcardOldSession[]

  //UNIQUE CONSTRAINT
  @@unique([userId, languageId, practiceId], name: "userId_languageId_practiceId")
}

model FlashcardCategory {
  id                    Int                   @id @default(autoincrement())
  flashcardId           Int
  name                  String

  //REFERANS ALDIKLARI (PARENT'LARI)
  flashcard             Flashcard             @relation(fields: [flashcardId], references: [id], onDelete: Cascade)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  flashcardOldSessions  FlashcardOldSession[]
  deckWords             DeckWord[]

}

model FlashcardOldSession {
  oldSessionId          String                @id
  flashcardId           Int
  categoryId            Int
  rate                  Decimal
  createdAt             DateTime              @default(now())

  //REFERANS ALDIKLARI (PARENT'LARI)
  flashcard             Flashcard             @relation(fields: [flashcardId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  category              FlashcardCategory     @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  flashcardSessionRows  FlashcardSessionRow[]
}

model DeckWord {
  id                    Int                   @id @default(autoincrement())
  categoryId            Int
  question              String
  answer                String

  //REFERANS ALDIKLARI (PARENT'LARI)
  category              FlashcardCategory     @relation(fields: [categoryId], references: [id], onDelete: Cascade)
}

model FlashcardSessionRow {
  id                    Int                   @id @default(autoincrement())
  oldSessionId          String
  question              String
  answer                String
  status                Boolean

  //REFERANS ALDIKLARI (PARENT'LARI)
  oldSession            FlashcardOldSession   @relation(fields: [oldSessionId], references: [oldSessionId], onDelete: Cascade)
}

model Listening {
  id                    Int                   @id @default(autoincrement())
  userId                String
  languageId            Int
  practiceId            Int

  //REFERANS ALDIKLARI (PARENT'LARI)
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  language              Language              @relation(fields: [languageId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  practice              Practice              @relation(fields: [practiceId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  listeningCategories   ListeningCategory[]
  listeningOldSessions  ListeningOldSession[]

  //UNIQUE CONSTRAINT
  @@unique([userId, languageId, practiceId], name: "userId_languageId_practiceId")
}

model ListeningCategory {
  id                    Int                   @id @default(autoincrement())
  listeningId           Int
  name                  String

  //REFERANS ALDIKLARI (PARENT'LARI)
  listening             Listening             @relation(fields: [listeningId], references: [id], onDelete: Cascade)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  listeningOldSessions  ListeningOldSession[]
  deckVideos            DeckVideo[]
}

model ListeningOldSession {
  oldSessionId          String                @id
  listeningId           Int
  categoryId            Int
  rate                  Decimal
  createdAt             DateTime              @default(now())

  //REFERANS ALDIKLARI (PARENT'LARI)
  listening             Listening             @relation(fields: [listeningId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  category              ListeningCategory     @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  listeningSessionRows  ListeningSessionRow[]
}

model DeckVideo {
  id                    Int                   @id @default(autoincrement())
  categoryId            Int
  correct               String
  sourceUrl             String

  //REFERANS ALDIKLARI (PARENT'LARI)
  category              ListeningCategory     @relation(fields: [categoryId], references: [id], onDelete: Cascade)
}

model ListeningSessionRow {
  id                    Int                   @id @default(autoincrement())
  oldSessionId          String
  listenedSentence      String
  answer                String
  similarity            Decimal

  //REFERANS ALDIKLARI (PARENT'LARI)
  oldSession            ListeningOldSession   @relation(fields: [oldSessionId], references: [oldSessionId], onDelete: Cascade)
}

model Writing {
  id                    Int                   @id @default(autoincrement())
  userId                String
  languageId            Int
  practiceId            Int

  //REFERANS ALDIKLARI (PARENT'LARI)
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  language              Language              @relation(fields: [languageId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  practice              Practice              @relation(fields: [practiceId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  writingBooks          WritingBook[]
  writingOldSessions    WritingOldSession[]

  //UNIQUE CONSTRAINT
  @@unique([userId, languageId, practiceId], name: "userId_languageId_practiceId")
}

model WritingBook {
  id                    Int                   @id @default(autoincrement())
  writingId             Int
  name                  String
  imageUrl              String
  leftColor             String
  sourceUrl             String

  //REFERANS ALDIKLARI (PARENT'LARI)
  writing               Writing               @relation(fields: [writingId], references: [id], onDelete: Cascade)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  writingOldSessions    WritingOldSession[]
}

model WritingOldSession {
  oldSessionId          String                @id
  writingId             Int
  bookId                Int
  rate                  Decimal
  createdAt             DateTime              @default(now())

  //REFERANS ALDIKLARI (PARENT'LARI)
  writing               Writing               @relation(fields: [writingId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  book                  WritingBook           @relation(fields: [bookId], references: [id], onDelete: Cascade)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  writingSessionRows    WritingSessionRow[]
}

model WritingSessionRow {
  id                    Int                   @id @default(autoincrement())
  oldSessionId          String
  selectedSentence      String
  answer                String
  answerTranslate       String
  similarity            Decimal

  //REFERANS ALDIKLARI (PARENT'LARI)
  oldSession            WritingOldSession     @relation(fields: [oldSessionId], references: [oldSessionId], onDelete: Cascade)

}

model Reading {
  id                    Int                   @id @default(autoincrement())
  userId                String
  languageId            Int
  practiceId            Int

  //REFERANS ALDIKLARI (PARENT'LARI)
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  language              Language              @relation(fields: [languageId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  practice              Practice              @relation(fields: [practiceId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  readingBooks          ReadingBook[]
  readingOldSessions    ReadingOldSession[]

  //UNIQUE CONSTRAINT
  @@unique([userId, languageId, practiceId], name: "userId_languageId_practiceId")
}

model ReadingBook {
  id                    Int                   @id @default(autoincrement())
  readingId             Int
  name                  String
  imageUrl              String
  leftColor             String
  sourceUrl             String

  //REFERANS ALDIKLARI (PARENT'LARI)
  reading               Reading               @relation(fields: [readingId], references: [id], onDelete: Cascade)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  readingOldSessions    ReadingOldSession[]
}

model ReadingOldSession {
  oldSessionId          String                @id
  readingId             Int
  bookId                Int
  rate                  Decimal
  createdAt             DateTime              @default(now())

  //REFERANS ALDIKLARI (PARENT'LARI)
  reading               Reading               @relation(fields: [readingId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  book                  ReadingBook           @relation(fields: [bookId], references: [id], onDelete: Cascade)

  //REFERANS VERDİKLERİ (CHILD'LARI)
  readingSessionRows    ReadingSessionRow[]
}


model ReadingSessionRow {
  id                    Int                   @id @default(autoincrement())
  oldSessionId          String
  selectedSentence      String
  answer                String
  answerTranslate       String
  similarity            Decimal

  //REFERANS ALDIKLARI (PARENT'LARI)
  oldSession            ReadingOldSession     @relation(fields: [oldSessionId], references: [oldSessionId], onDelete: Cascade)
}